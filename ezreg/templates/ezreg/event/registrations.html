<script src="/static/ezreg/js/pages/event_registrations.js"></script>


<script type="text/ng-template" id="checkbox_filter.html">
    <input type="checkbox" name="{{name}}" ng-model="params.filter()[name]" class="input-filter form-control" ng-value="'True'" ng-true-value="'True'" ng-false-value="'False'" />
</script>
<script type="text/ng-template" id="path/to/your/filters/number.html">
    <input type="text" name="{{name}}" ng-disabled="$filterRow.disabled" ng-model="params.filter()[name]" class="input-filter form-control" maxlengh="4" angular-mask="0000" placeholder="nnnn" />
</script>

<div ng-controller="RegistrationController" ng-init='init("{{event.id}}",{{statuses|safe}},{{processors|safe}},{{payment_statuses|safe}} );'>
	<span class="pull-right">
	{[getSelected().length]} selected
		<div class="btn-group" dropdown is-open="status.isopen">
		  <button type="button" class="btn btn-default" dropdown-toggle ng-disabled="disabled">
		    Action<span class="caret"></span>
		  </button>
		  <ul class="dropdown-menu" role="menu" aria-labelledby="Action">
		  {% if 'admin' in permissions %}
		    <li role="menuitem" ng-click="update_statuses()"><a href="#">Update Statuses</a></li>
		  {% endif %}
		    <li role="menuitem" ng-click="export_registrations()"><a href="#">Export</a></li>
		  </ul>
		</div>
	</span>
	
    <table ng-table="tableParams" show-filter="true" class="table table-bordered table-striped table-condensed">
      <tr ng-repeat="row in $data track by row.id">
        <td data-title="'Registered'" sortable="'registered'" style="width:170px"><label><input type="checkbox" ng-model="checked[row.id]"/> {[row.registered | date:'short']}</label></td>
        <td data-title="'First Name'" filter="{first_name__icontains: 'text'}" sortable="'first_name'">{[row.first_name]}</td>
        <td data-title="'Last Name'" filter="{last_name__icontains: 'text'}" sortable="'last_name'">{[row.last_name]}</td>
        <td data-title="'Email'" filter="{email__icontains: 'text'}" sortable="'email'">{[row.email]}</td>
        <td data-title="'Amount'" sortable="'payment__amount'">{[row.payment__amount]}</td>
        <td data-title="'Processor'" filter="{payment__processor__name: 'select'}" filter-data="processors_filter_choices" >{[row.payment__processor]}</td>
		<td data-title="'Status'" filter="{status: 'select'}" filter-data="statuses_filter_choices">{[statuses[row.status]]}</td>
		<td data-title="'Payment Status'" filter="{payment__status: 'select'}" filter-data="payment_status_filter_choices">{[payment_statuses[row.payment__status]]}</td>
		<td data-title="'Test'" filter="{test: 'checkbox'}"><i ng-if="row.test" class="glyphicon glyphicon-ok"></i></td>
		<td data-title="'Actions'">
			<div class="btn-group" dropdown is-open="isopen[row.id]">
			  <button type="button" class="btn btn-default" dropdown-toggle ng-disabled="disabled">
			    Action<span class="caret"></span>
			  </button>
			  <ul class="dropdown-menu" role="menu" aria-labelledby="Action">
			    <li role="menuitem"><a href="{[registrationLink(row)]}">View details</a></li>
			    {% if 'admin' in permissions %}
			    	<li role="menuitem"><a href="{[modifyRegistrationLink(row)]}">Modify</a></li>
			    	<li role="menuitem"><a href="{[updateRegistrationStatusLink(row)]}">Update status</a></li>
			    {% endif %}
			  </ul>
			</div>
		</td>
      </tr>
    </table>


    
    <script type="text/ng-template" id="updateStatus.html">
        <div class="modal-header">
            <h3 class="modal-title">Update statuses (<span title="{[params.selected.join(', ')]}">{[params.selected.length]}</span>)</h3>
        </div>
        <div class="modal-body">
            <div class="form-group form-inline">
   				<label><input type="checkbox" ng-model="params.send_email"/>Send email</label><br>
			    <select class="form-control" ng-model="params.status">
					{% for value,label in Registration.STATUSES %}
						<option value="{{value}}">{{label}}</option>
					{% endfor %}
				</select> <button ng-click="update_statuses()" class="btn btn-default">Update Statuses</button>
    		</div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>
        </div>
    </script>
    <script type="text/ng-template" id="exportRegistrations.html">
        <div class="modal-header">
            <h3 class="modal-title">Export registrations (<span title="{[selected.join(', ')]}">{[selected.length]}</span>)</h3>
        </div>
        <div class="modal-body">
            <div class="form-group form-inline">
   				<form id="exportForm" action="{% url 'export_registrations' event=event.id %}" method="POST">
					{% csrf_token %}

					<fieldset>
					{% for field in event.form_fields %}
					{% if field.label %}
						<label><input type="checkbox" name="fields_{{field.name}}"/> {{field.label}}</label>
					{% endif %}
					{% endfor %}
					</fieldset>
    				<input ng-repeat="val in selected" type="hidden" name="selection" value="{[val]}"/>
    			</form>  
    		</div>
        </div>
        <div class="modal-footer">
			<button class="btn btn-default"  ng-click="export_registrations()">Export</button>
            <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>
        </div>
    </script>
  </div>


